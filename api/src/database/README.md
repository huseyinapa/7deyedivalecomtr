# Database Migration Infrastructure

This directory contains database migration files used to manage the database schema through TypeORM. The migration system provides a safe way to make database changes across different environments.

## Directory Structure

```
src/database/
├── data-source.ts         # TypeORM data source configuration for CLI operations
├── database.module.ts     # NestJS module for database services
├── database.service.ts    # Service to configure and manage database connections
├── migration.ts           # CLI tool for migration operations
├── seeder.ts              # Database seeding utility
├── migrations/            # Migration files generated by TypeORM
│   └── ...
└── seeds/                 # Seeder classes for different entities
    └── user.seeder.ts
```

## Usage

### Creating a new migration

To create a new migration file:

```bash
npm run migration:create
```

This will prompt you for a migration name and create a timestamped migration file in the `migrations` directory.

### Running migrations

To apply all pending migrations:

```bash
npm run migration:run
```

### Reverting migrations

To revert the last applied migration:

```bash
npm run migration:revert
```

### Database seeding

To seed the database with initial data:

```bash
npm run seed
```

## Migration Best Practices

1. **Incremental Changes**: Each migration should make a small, focused change
2. **Reversible Operations**: Always implement the `down` method to reverse changes
3. **Test Before Deploying**: Always test migrations in a non-production environment
4. **Keep Migrations**: Never delete old migration files, even after they're applied
5. **Version Control**: Always commit migration files to version control

## Seeder Best Practices

1. **Idempotent Operations**: Seeds should be safe to run multiple times
2. **Production Data**: Avoid seeding sensitive data in production
3. **Test Data**: Use seeds to populate test environments with realistic data
4. **Dependency Order**: Create seeds in the correct order to respect foreign key constraints
